{"version":3,"file":"lightdom.min.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-10-13 14:28:33\n * @Description: ******\n */\n\nlet cached: number;\nfunction measureScrollBarSize(fresh?: boolean) {\n  if (typeof document === 'undefined') {\n    return 0;\n  }\n  if (fresh || cached === undefined) {\n    const inner = document.createElement('div');\n    inner.style.width = '100%';\n    inner.style.height = '200px';\n    const outer = document.createElement('div');\n    const outerStyle = outer.style;\n    outerStyle.position = 'absolute';\n    outerStyle.top = '0';\n    outerStyle.left = '0';\n    outerStyle.pointerEvents = 'none';\n    outerStyle.visibility = 'hidden';\n    outerStyle.width = '200px';\n    outerStyle.height = '150px';\n    outerStyle.overflow = 'hidden';\n    outer.appendChild(inner);\n    document.body.appendChild(outer);\n    const widthContained = inner.offsetWidth;\n    outer.style.overflow = 'scroll';\n    let widthScroll = inner.offsetWidth;\n    if (widthContained === widthScroll) {\n      widthScroll = outer.clientWidth;\n    }\n    document.body.removeChild(outer);\n    cached = widthContained - widthScroll;\n  }\n  return cached;\n}\nfunction ensureSize(str: string) {\n  const match = str.match(/^(.*)px$/);\n  const value = Number(match?.[1]);\n  return Number.isNaN(value) ? measureScrollBarSize() : value;\n}\n\n// 驼峰转连字符\nexport function humpToHyphen(key: string) {\n  return key.replace(/([A-Z])/g, '-$1').toLocaleLowerCase();\n}\n// 转连字符转驼峰\nexport function hyphenToHump(name: string) {\n  return name.replace(/-(.?)/g, (t) => t.replace('-', '').toLocaleUpperCase());\n}\n\n// 获取滚动条宽度\nexport function getScrollBarSize(target: Element | boolean) {\n  if (typeof target === 'boolean') {\n    const size = measureScrollBarSize(target);\n    return {\n      width: size,\n      height: size,\n    };\n  }\n  if (typeof document === 'undefined' || !target || !(target instanceof Element)) {\n    return { width: 0, height: 0 };\n  }\n  const { width, height } = getComputedStyle(target, '::-webkit-scrollbar');\n  return {\n    width: ensureSize(width),\n    height: ensureSize(height),\n  };\n}\n\n// 检查是否处于overflow\nexport function isBodyOverflowing() {\n  return (\n    document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight) &&\n    window.innerWidth > document.body.offsetWidth\n  );\n}\n\n// 将css注入head\nexport function cssInject(id: string, cssText: string) {\n  let style = document.querySelector(`#${id}`);\n  if (!style) {\n    style = document.createElement('style');\n    style.id = id;\n    style.appendChild(document.createTextNode(cssText));\n    (document.head || document.getElementsByTagName('head')[0]).appendChild(style);\n  }\n}\n\n// 设置css\nexport type ICSSStyle = { [key: string]: string | number | undefined };\nconst autoPxReg =\n  /^(?:-border(?:-top|-right|-bottom|-left)?(?:-width|)|(?:-margin|-padding)?(?:-top|-right|-bottom|-left)?|(?:-min|-max)?(?:-width|-height))$/;\nexport function setStyle(el?: Element | null, style?: ICSSStyle) {\n  if (el && style) {\n    let cssText = '';\n    Object.keys(style).forEach((key: string) => {\n      const name = humpToHyphen(key);\n      const value = style[key];\n      if (value || value === 0) {\n        const suffix =\n          typeof value === 'number' && /^[a-z]/.test(name) && autoPxReg.test(`-${name}`)\n            ? 'px'\n            : '';\n        cssText += `${name}: ${value}${suffix};`;\n      } else {\n        (el as HTMLElement | SVGElement).style.removeProperty(name);\n      }\n    });\n    (el as HTMLElement | SVGElement).style.cssText += cssText;\n  }\n  return el;\n}\n\nexport function hasClass(el?: Element | null, className?: string) {\n  if (el && className) {\n    return el.classList.contains(className);\n  }\n  return false;\n}\n\nexport function addClass(el?: Element | null, className?: string | string[]) {\n  if (el && className) {\n    (Array.isArray(className) ? className : className.split(' ')).forEach(\n      (c) => c && el.classList.add(c),\n    );\n  }\n  return el;\n}\n\nexport function removeClass(el?: Element | null, className?: string | string[]) {\n  if (el && className) {\n    (Array.isArray(className) ? className : className.split(' ')).forEach(\n      (c) => c && el.classList.remove(c),\n    );\n  }\n  return el;\n}\n\nexport type IElement = string | Element | (() => Element | null | undefined) | null | undefined;\n\nexport function getElement(container?: IElement) {\n  let _container: any = container;\n  if (typeof container === 'string') {\n    _container = document.querySelector(container);\n  }\n  if (typeof container === 'function') {\n    _container = container();\n  }\n  return (_container || null) as Element | null;\n}\ntype IChildren = string | number | boolean | null | undefined | Element;\ntype IProps = {\n  className?: string | string[];\n  style?: ICSSStyle;\n  attrs?: {\n    [key: string]: string;\n  };\n};\nexport function createElement(\n  type?: string | IProps,\n  props?: IProps | IChildren | IChildren[],\n  children?: IChildren | IChildren[] | IElement,\n  parent?: Element,\n) {\n  let _type: string;\n  let _props: IProps;\n  let _children: IChildren[];\n  let _parent: IElement;\n  if (typeof type === 'string') {\n    _type = type;\n    _props = (props || {}) as IProps;\n    _children = (Array.isArray(children) ? children : [children]) as IChildren[];\n    _parent = parent as IElement;\n  } else {\n    // 没有type的情况，参数向前推一个位置\n    _type = 'div';\n    _props = type || {};\n    _children = (Array.isArray(props) ? props : [props]) as IChildren[];\n    _parent = children as IElement;\n  }\n  const element = setStyle(\n    addClass(document.createElement(_type), _props.className),\n    _props.style,\n  ) as Element;\n  const _attrs = _props.attrs || {};\n  Object.keys(_attrs).forEach((key) => {\n    if (key !== 'innerHTML' && key !== 'className' && key !== 'style') {\n      element.setAttribute(humpToHyphen(key), _attrs[key]);\n    }\n  });\n  _children.forEach((child) => {\n    if (child instanceof Element) {\n      element?.appendChild(child);\n    } else if (element && typeof child !== 'undefined' && child !== null) {\n      element.innerHTML = String(child);\n    }\n  });\n  getElement(_parent)?.appendChild(element);\n  return element;\n}\n"],"names":["cached","measureScrollBarSize","fresh","document","undefined","inner","createElement","style","width","height","outer","outerStyle","position","top","left","pointerEvents","visibility","overflow","appendChild","body","widthContained","offsetWidth","widthScroll","clientWidth","removeChild","ensureSize","str","match","value","Number","isNaN","humpToHyphen","key","replace","toLocaleLowerCase","hyphenToHump","name","t","toLocaleUpperCase","getScrollBarSize","target","size","Element","getComputedStyle","isBodyOverflowing","scrollHeight","window","innerHeight","documentElement","clientHeight","innerWidth","cssInject","id","cssText","querySelector","createTextNode","head","getElementsByTagName","autoPxReg","setStyle","el","Object","keys","forEach","suffix","test","removeProperty","hasClass","className","classList","contains","addClass","Array","isArray","split","c","add","removeClass","remove","getElement","container","_container","type","props","children","parent","_getElement","_type","_props","_children","_parent","element","_attrs","attrs","setAttribute","child","innerHTML","String"],"mappings":"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"}