{"version":3,"file":"lightdom.min.js","sources":["../src/index.ts"],"sourcesContent":["/*\n * @Author: Huangjs\n * @Date: 2023-02-13 15:22:58\n * @LastEditors: Huangjs\n * @LastEditTime: 2023-10-08 09:44:53\n * @Description: ******\n */\n\nlet cached: number;\nfunction measureScrollBarSize(fresh?: boolean) {\n  if (typeof document === 'undefined') {\n    return 0;\n  }\n  if (fresh || cached === undefined) {\n    const inner = document.createElement('div');\n    inner.style.width = '100%';\n    inner.style.height = '200px';\n    const outer = document.createElement('div');\n    const outerStyle = outer.style;\n    outerStyle.position = 'absolute';\n    outerStyle.top = '0';\n    outerStyle.left = '0';\n    outerStyle.pointerEvents = 'none';\n    outerStyle.visibility = 'hidden';\n    outerStyle.width = '200px';\n    outerStyle.height = '150px';\n    outerStyle.overflow = 'hidden';\n    outer.appendChild(inner);\n    document.body.appendChild(outer);\n    const widthContained = inner.offsetWidth;\n    outer.style.overflow = 'scroll';\n    let widthScroll = inner.offsetWidth;\n    if (widthContained === widthScroll) {\n      widthScroll = outer.clientWidth;\n    }\n    document.body.removeChild(outer);\n    cached = widthContained - widthScroll;\n  }\n  return cached;\n}\nfunction ensureSize(str: string) {\n  const match = str.match(/^(.*)px$/);\n  const value = Number(match?.[1]);\n  return Number.isNaN(value) ? measureScrollBarSize() : value;\n}\nexport function getScrollBarSize(target: Element | boolean) {\n  if (typeof target === 'boolean') {\n    const size = measureScrollBarSize(target);\n    return {\n      width: size,\n      height: size,\n    };\n  }\n  if (typeof document === 'undefined' || !target || !(target instanceof Element)) {\n    return { width: 0, height: 0 };\n  }\n  const { width, height } = getComputedStyle(target, '::-webkit-scrollbar');\n  return {\n    width: ensureSize(width),\n    height: ensureSize(height),\n  };\n}\n\nexport function isBodyOverflowing() {\n  return (\n    document.body.scrollHeight > (window.innerHeight || document.documentElement.clientHeight) &&\n    window.innerWidth > document.body.offsetWidth\n  );\n}\n\nexport function cssInject(id: string, cssText: string) {\n  let style = document.querySelector(`#${id}`);\n  if (!style) {\n    style = document.createElement('style');\n    style.id = id;\n    style.appendChild(document.createTextNode(cssText));\n    (document.head || document.getElementsByTagName('head')[0]).appendChild(style);\n  }\n}\n\nexport type ICSSStyle = { [key: string]: string | number | undefined };\nconst autoPxReg =\n  /^(?:-border(?:-top|-right|-bottom|-left)?(?:-width|)|(?:-margin|-padding)?(?:-top|-right|-bottom|-left)?|(?:-min|-max)?(?:-width|-height))$/;\nexport function setStyle(el?: Element | null, style?: ICSSStyle) {\n  if (el && style) {\n    let cssText = '';\n    Object.keys(style).forEach((key: string) => {\n      // 转连字符\n      const name = key.replace(/([A-Z])/g, '-$1').toLocaleLowerCase();\n      // 转驼峰\n      // const key = name.replace(/-(.?)/g, (t) => t.replace('-', '').toLocaleUpperCase());\n      const value = style[key];\n      if (value || value === 0) {\n        const suffix =\n          typeof value === 'number' && /^[a-z]/.test(name) && autoPxReg.test(`-${name}`)\n            ? 'px'\n            : '';\n        cssText += `${name}: ${value}${suffix};`;\n      } else {\n        (el as HTMLElement | SVGElement).style.removeProperty(name);\n      }\n    });\n    (el as HTMLElement | SVGElement).style.cssText += cssText;\n  }\n  return el;\n}\n\nexport function hasClass(el?: Element | null, className?: string) {\n  if (el && className) {\n    return el.classList.contains(className);\n  }\n  return false;\n}\n\nexport function addClass(el?: Element | null, className?: string | string[]) {\n  if (el && className) {\n    (Array.isArray(className) ? className : className.split(' ')).forEach(\n      (c) => c && el.classList.add(c),\n    );\n  }\n  return el;\n}\n\nexport function removeClass(el?: Element | null, className?: string | string[]) {\n  if (el && className) {\n    (Array.isArray(className) ? className : className.split(' ')).forEach(\n      (c) => c && el.classList.remove(c),\n    );\n  }\n  return el;\n}\n\nexport type IElement = string | Element | (() => Element | null | undefined) | null | undefined;\n\nexport function getElement(container?: IElement) {\n  let _container: any = container;\n  if (typeof container === 'string') {\n    _container = document.querySelector(container);\n  }\n  if (typeof container === 'function') {\n    _container = container();\n  }\n  return (_container || null) as Element | null;\n}\ntype IChildren = string | number | boolean | null | undefined | Element;\ntype IProps = {\n  className?: string | string[];\n  style?: ICSSStyle;\n  attrs?: {\n    [key: string]: string;\n  };\n};\nexport function createElement(\n  type?: string | IProps,\n  props?: IProps | IChildren | IChildren[],\n  children?: IChildren | IChildren[] | IElement,\n  parent?: Element,\n) {\n  let _type: string;\n  let _props: IProps;\n  let _children: IChildren[];\n  let _parent: IElement;\n  if (typeof type === 'string') {\n    _type = type;\n    _props = (props || {}) as IProps;\n    _children = (Array.isArray(children) ? children : [children]) as IChildren[];\n    _parent = parent as IElement;\n  } else {\n    // 没有type的情况，参数向前推一个位置\n    _type = 'div';\n    _props = type || {};\n    _children = (Array.isArray(props) ? props : [props]) as IChildren[];\n    _parent = children as IElement;\n  }\n  const element = setStyle(\n    addClass(document.createElement(_type), _props.className),\n    _props.style,\n  ) as Element;\n  const _attrs = _props.attrs || {};\n  Object.keys(_attrs).forEach((key) => {\n    if (key !== 'innerHTML' && key !== 'className' && key !== 'style' && key in element) {\n      (element as any)[key] = _attrs[key];\n    }\n  });\n  _children.forEach((child) => {\n    if (child instanceof Element) {\n      element?.appendChild(child);\n    } else if (element && typeof child !== 'undefined' && child !== null) {\n      element.innerHTML = String(child);\n    }\n  });\n  getElement(_parent)?.appendChild(element);\n  return element;\n}\n"],"names":["cached","measureScrollBarSize","fresh","document","undefined","inner","createElement","style","width","height","outer","outerStyle","position","top","left","pointerEvents","visibility","overflow","appendChild","body","widthContained","offsetWidth","widthScroll","clientWidth","removeChild","ensureSize","str","match","value","Number","isNaN","getScrollBarSize","target","size","Element","getComputedStyle","isBodyOverflowing","scrollHeight","window","innerHeight","documentElement","clientHeight","innerWidth","cssInject","id","cssText","querySelector","createTextNode","head","getElementsByTagName","autoPxReg","setStyle","el","Object","keys","forEach","key","name","replace","toLocaleLowerCase","suffix","test","removeProperty","hasClass","className","classList","contains","addClass","Array","isArray","split","c","add","removeClass","remove","getElement","container","_container","type","props","children","parent","_getElement","_type","_props","_children","_parent","element","_attrs","attrs","child","innerHTML","String"],"mappings":"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"}